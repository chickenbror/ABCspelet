{"ast":null,"code":"import _toConsumableArray from\"C:/CodingProjects/ABCspelet/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:/CodingProjects/ABCspelet/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{assign,send}from\"xstate\";//Instantiate a new obj for each new round of game\nimport{makeNewQuestions,randomChoice}from'./game_codes/game';var quesJSON=require('./game_codes/questionsSV.json');//Source of game questions; require() only works on server\n// let qs=makeNewQuestions(quesJSON)\n// console.log(qs.letter)\n// console.log(qs.ques)\n//Using \"Natural\" NLP library --Swedish lemmatizer?\nvar natural=require('natural'),nounInflector=new natural.NounInflector();// let singular = nounInflector.singularize('those tomatoes');\n// console.log(singular); //>>those tomato\n// var snowball = require('node-snowball');\n// // Using String\n// let stemmed = snowball.stemword('consignment'); // 'consign'\n// console.log(stemmed)\n// https://json-tagger.com/ needs CORS...?\n// const proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n// const taggerurl = 'https://json-tagger.com/tag'\n// const taggerRequest = (text: string) =>\n//     fetch(new Request(proxyurl + taggerurl, {\n//         method: 'POST',\n//         headers: { 'Origin': 'http://maraev.me' }, // only required with proxy\n//         body: `${text}`\n//         })\n//         )\n//         .then(data => data.json());\n// console.log( taggerRequest(\"Fördomen har alltid sin rot i vardagslivet - Olof Palme\") )\n// var request = require('request');\n// request.post({url: 'https://json-tagger.com/tag', body: \"Fördomen har alltid sin rot i vardagslivet - Olof Palme\"}, function (error, response, body) {\n//     console.log(body)\n// })\nvar clearRecResult=assign(function(context){return{recResult:''};});var clearTTSAgenda=assign(function(context){return{ttsAgenda:''};});var resetTally=assign(function(context){return{tally:0};});var clearLetter=assign(function(context){return{letter:undefined};});var confettiOn=assign(function(context){return{confettiSwitch:true};});var confettiOff=assign(function(context){return{confettiSwitch:false};});var gameOn=assign(function(context){return{playingNow:true};});var gameOff=assign(function(context){return{playingNow:false};});//Initiate a questions object & assign values to context.letter/questions/tally\nvar newGameRound=assign(function(context){var qs=makeNewQuestions(quesJSON);console.log(\"Last round:\".concat(context.lastLetter));console.log(qs.ques);return{letter:qs.letter,questions:qs.ques,tally:0,skipped:0,hinted:0,confettiSwitch:false};});//After chosen a letter and before going saying it, remember it for referece of next game round\nvar rememberLetter=assign(function(context){return{lastLetter:context.letter};});// const remember3Letters: Action<SDSContext, SDSEvent> = assign((context) => { \n//     let last3Letters= context.lastLetters? context.lastLetters : []\n//     last3Letters.push(context.letter)\n//     if(last3Letters.length>3){\n//         last3Letters.shift()\n//     }\n//     return { lastLetters: last3Letters} \n// })\n//Say the current random letter and a 'spelling/phonetic' alphabet\nfunction letterNow(context){var alphabet={'a':'Amanda','b':'Benedikt','c':'Cecilia','d':'Daniel','e':'Emma','f':'Filippa','g':'Gustav','h':'Håkan','i':'Ida','j':'Julia','k':'Klara','l':'Lotta','m':'Markus','n':'Natalie','o':'Olof','p':'Paula','q':'Queen','r':'Rebecka','s':'Sven','t':'Therese','u':'Ulla','v':'Viktoria','w':'Wanda','x':'Xavier','y':'Ylva','z':'Zara','å':'Åsa','ä':'Ängel','ö':'Örebro'};var letter=context.letter;return\"Bokstaven \\xE4r \\\"\".concat(letter.toUpperCase(),\"\\\" f\\xF6r \\\"\").concat(alphabet[letter],\"\\\". \");}function questionNow(context){var category=context.questions[0].category;//the question at front of array\nreturn\"N\\xE4mn \".concat(category,\". \");}function giveHint(context){var answers=context.questions[0].answers;//answers to the question at front of array\nvar anAns=randomChoice(answers);if(anAns.length>=2){var hint=anAns.slice(0,3).toUpperCase();//first 3 letters\nreturn\"Stavas med \".concat(hint[0],\", \").concat(hint[1],\", \").concat(hint[2],\".\");}//in case word is too short>>hint only 2 letters\nelse{var _hint=anAns.slice(0,2).toUpperCase();//first 2 letters\nreturn\"Stavas med \".concat(_hint[0],\", \").concat(_hint[1],\".\");}}//Partial match of user input, as long as input mentions an answer\nfunction answerMatches(input,context){var reply=input.toLowerCase();//convert to lowercase\nvar replySing=nounInflector.singularize(reply);//convert to singular form\nvar answers=context.questions[0].answers;//answers to the question at front of array\n//True if reply--either original or singularised--mentions an answer \n//(eg, 'the Netherlands' matches 'netherlands'; 'these strawberries' matches 'strawberry')\nreturn exists(reply,answers)||exists(replySing,answers);}function say(text){return send(function(_context){return{type:\"SPEAK\",value:text};});}function sharedRecognitions(){return[{target:'stop',cond:function cond(context){return sayKeyword(context.recResult)==='stop';}},{target:'restart',cond:function cond(context){return sayKeyword(context.recResult)==='restart';}},//for testing \n{target:'winning',cond:function cond(context){return sayKeyword(context.recResult)==='shortcut';}},{target:\".nomatch\"}];}function promptAndAsk(promptEvent){return{initial:'prompt',states:{prompt:{entry:promptEvent,on:{ENDSPEECH:'ask'}},ask:{entry:send('LISTEN')},nomatch:{entry:[say(\"Försök igen\")],on:{ENDSPEECH:\"prompt\"}}}};}// Similar to python: any(keyword in input for keyword in keywords)\nfunction exists(input,keywords){var existence=keywords.some(function(keyword){return input.includes(keyword);});return existence;}//Replace this with grammar parser?\nfunction sayKeyword(reply){var yes=[\"ja\",\"naturligtvis\",\"säker\",\"absolut\",\"javisst\",\"visst\",\"okej\",\"ok\"];var no=[\"nej\",\"nä\",\"nej tack\"];var pass=[\"hoppa\",\"pass\",\"nästa\"];var hint=[\"hint\",\"tips\",\"ledtråd\",\"hjälp\"];var whatletter=['bokstav','upprepa'];var stop=['stop','avsluta','sluta','stopp'];var restart=['starta om','börja om','starta igen',\"omstarta\",\"börja igen\"];var shortcut=['short cut','shortcut'];//for testing\nreply=reply.toLowerCase();if(exists(reply,yes)){return'yes';}if(exists(reply,no)){return'no';}if(exists(reply,pass)){return'pass';}if(exists(reply,hint)){return'hint';}if(exists(reply,whatletter)){return'whatletter';}if(exists(reply,stop)){return'stop';}if(exists(reply,restart)){return'restart';}if(exists(reply,shortcut)){return'shortcut';}//for testing\n}export var dmMachine={initial:'init',states:{init:{on:{CLICK:'start'}},stop:{entry:say(\"Hej och farväl!\"),on:{ENDSPEECH:{actions:[resetTally,clearLetter,clearTTSAgenda,clearRecResult,confettiOff,gameOff],target:\"init\"}}},//Start/restart new game: initiate new questions-object & reset tally counter\nstart:{entry:say(\"Var redo att spela!\"),on:{ENDSPEECH:{target:\"chooseNewLetter\"}}},restart:{entry:say(\"Okej, vi börjar om!\"),on:{ENDSPEECH:{target:\"chooseNewLetter\"}}},chooseNewLetter:{always:[{actions:[newGameRound,clearTTSAgenda,clearRecResult],target:\"checkLastLetter\"}]},//After choosing letter, comparing to last letter game so that the new letter is not repeated\ncheckLastLetter:{always:[//if chosen letter is the same as last ones >> choose again\n{cond:function cond(context){return!!context.lastLetter&&context.letter===context.lastLetter;},target:'chooseNewLetter'},//chosen letter is different from last 3 letters >> remember it & resume game\n{actions:[rememberLetter,gameOn],target:'sayletter'}]},//Starting the game for real from this state\n//Say the letter\nsayletter:{entry:send(function(context){return{type:\"SPEAK\",value:letterNow(context)};}),on:{ENDSPEECH:'askQues'}},//Ask 5 (or more if skipping) questions \naskQues:_objectSpread({on:{RECOGNISED:[// ? Clear recResult after recognition or not...?\n// If answer matches answers, tally+=1, shift question[0]\n{cond:function cond(context){return answerMatches(context.recResult,context);},actions:assign(function(context){context.questions.shift();return{tally:context.tally+1};}),target:\"checkscore\"},//If pass, move the question to the last (unshift & push)\n{cond:function cond(context){return sayKeyword(context.recResult)==='pass';},target:\"skip\"},//Hint 3 or 2 letters\n{cond:function cond(context){return sayKeyword(context.recResult)==='hint';},target:\"hint\"},//Repeat letter\n{cond:function cond(context){return sayKeyword(context.recResult)==='whatletter';},target:\"sayletter\"}].concat(_toConsumableArray(sharedRecognitions()))}},promptAndAsk(send(function(context){return{type:\"SPEAK\",value:questionNow(context)};}))),skip:{initial:'checkSkipped',states:{checkSkipped:{always:[{target:'letSkip',cond:function cond(context){return context.skipped<5;}},{target:'maxSkipped',cond:function cond(context){return context.skipped>=5;}}]},//move the question to the last (unshift & push); context.skipped++\nletSkip:{entry:assign(function(context){var skipped=context.questions.shift();context.questions.push(skipped);console.log(\"Skipped so far: \".concat(context.skipped+1,\" \"));console.log(context.questions);return{skipped:context.skipped+1};}),always:'#checkscore'},maxSkipped:{entry:say(\"\\xC5jojoj, du har hoppat \\xF6ver f\\xF6r m\\xE5nga g\\xE5nger!\"),on:{ENDSPEECH:{target:'#checkscore'}}}}},hint:{initial:'checkHinted',states:{checkHinted:{always:[{target:'giveHint',cond:function cond(context){return context.hinted<5;}},{target:'maxHinted',cond:function cond(context){return context.hinted>=5;}}]},//Hint 3 or 2 letters or a random answer; context.hinted++\ngiveHint:{entry:[send(function(context){return{type:\"SPEAK\",value:giveHint(context)};}),assign(function(context){console.log(\"Hinted so far: \".concat(context.hinted+1,\" \"));return{hinted:context.hinted+1};})],always:'#checkscore'// use 'on endspeech...' if we want the question being said again\n},maxHinted:{entry:say(\"\\xC5jojoj, du har bett om f\\xF6r m\\xE5nga hints!\"),on:{ENDSPEECH:{target:'#checkscore'}}}}},checkscore:{id:\"checkscore\",always:[//Less than 5 correct\n{target:'askQues',cond:function cond(context){return context.tally<5;}},//5 correct\n{target:'winning',cond:function cond(context){return context.tally>=5;}}]},//? reset/clear tally here or not...? \nwinning:{entry:[say(\"Du vann, winner winner chicken dinner!\"),confettiOn,clearTTSAgenda],on:{ENDSPEECH:{target:'playagain'}}},playagain:_objectSpread({entry:[clearRecResult,confettiOff,resetTally,clearLetter,gameOff],on:{RECOGNISED:[//Play again? restart:stop\n{cond:function cond(context){return sayKeyword(context.recResult)==='yes';},target:\"restart\"},{cond:function cond(context){return sayKeyword(context.recResult)==='no';},target:\"stop\"}].concat(_toConsumableArray(sharedRecognitions()))}},promptAndAsk(say('Vill du spela igen?')))}};","map":{"version":3,"sources":["C:/CodingProjects/ABCspelet/src/dmGame.ts"],"names":["assign","send","makeNewQuestions","randomChoice","quesJSON","require","natural","nounInflector","NounInflector","clearRecResult","context","recResult","clearTTSAgenda","ttsAgenda","resetTally","tally","clearLetter","letter","undefined","confettiOn","confettiSwitch","confettiOff","gameOn","playingNow","gameOff","newGameRound","qs","console","log","lastLetter","ques","questions","skipped","hinted","rememberLetter","letterNow","alphabet","toUpperCase","questionNow","category","giveHint","answers","anAns","length","hint","slice","answerMatches","input","reply","toLowerCase","replySing","singularize","exists","say","text","_context","type","value","sharedRecognitions","target","cond","sayKeyword","promptAndAsk","promptEvent","initial","states","prompt","entry","on","ENDSPEECH","ask","nomatch","keywords","existence","some","keyword","includes","yes","no","pass","whatletter","stop","restart","shortcut","dmMachine","init","CLICK","actions","start","chooseNewLetter","always","checkLastLetter","sayletter","askQues","RECOGNISED","shift","skip","checkSkipped","letSkip","push","maxSkipped","checkHinted","maxHinted","checkscore","id","winning","playagain"],"mappings":"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","sourcesContent":["import { MachineConfig, actions, Action, assign, send } from \"xstate\";\r\n\r\n//Instantiate a new obj for each new round of game\r\nimport { makeNewQuestions, randomChoice } from './game_codes/game'\r\nconst quesJSON = require('./game_codes/questionsSV.json') //Source of game questions; require() only works on server\r\n// let qs=makeNewQuestions(quesJSON)\r\n// console.log(qs.letter)\r\n// console.log(qs.ques)\r\n\r\n//Using \"Natural\" NLP library --Swedish lemmatizer?\r\nconst natural = require('natural'),\r\nnounInflector = new natural.NounInflector();\r\n// let singular = nounInflector.singularize('those tomatoes');\r\n// console.log(singular); //>>those tomato\r\n\r\n// var snowball = require('node-snowball');\r\n\r\n// // Using String\r\n// let stemmed = snowball.stemword('consignment'); // 'consign'\r\n// console.log(stemmed)\r\n\r\n// https://json-tagger.com/ needs CORS...?\r\n// const proxyurl = \"https://cors-anywhere.herokuapp.com/\";\r\n// const taggerurl = 'https://json-tagger.com/tag'\r\n// const taggerRequest = (text: string) =>\r\n//     fetch(new Request(proxyurl + taggerurl, {\r\n//         method: 'POST',\r\n//         headers: { 'Origin': 'http://maraev.me' }, // only required with proxy\r\n//         body: `${text}`\r\n//         })\r\n//         )\r\n//         .then(data => data.json());\r\n// console.log( taggerRequest(\"Fördomen har alltid sin rot i vardagslivet - Olof Palme\") )\r\n// var request = require('request');\r\n// request.post({url: 'https://json-tagger.com/tag', body: \"Fördomen har alltid sin rot i vardagslivet - Olof Palme\"}, function (error, response, body) {\r\n//     console.log(body)\r\n// })\r\n\r\n\r\n\r\n\r\n\r\nconst clearRecResult: Action<SDSContext, SDSEvent> = assign((context) => { return { recResult:''} })\r\nconst clearTTSAgenda: Action<SDSContext, SDSEvent> = assign((context) => { return { ttsAgenda:''} })\r\nconst resetTally: Action<SDSContext, SDSEvent> = assign((context) => { return { tally:0} })\r\nconst clearLetter: Action<SDSContext, SDSEvent> = assign((context) => { return { letter:undefined} })\r\n\r\nconst confettiOn: Action<SDSContext, SDSEvent> = assign((context) => { return { confettiSwitch:true} })\r\nconst confettiOff: Action<SDSContext, SDSEvent> = assign((context) => { return { confettiSwitch:false} })\r\n\r\nconst gameOn: Action<SDSContext, SDSEvent> = assign((context) => { return { playingNow:true} })\r\nconst gameOff: Action<SDSContext, SDSEvent> = assign((context) => { return { playingNow:false} })\r\n\r\n//Initiate a questions object & assign values to context.letter/questions/tally\r\nconst newGameRound: Action<SDSContext, SDSEvent> = assign((context) => { \r\n    let qs=makeNewQuestions( quesJSON );\r\n    console.log(`Last round:${context.lastLetter}`)\r\n    console.log(qs.ques)\r\n    return { letter: qs.letter, questions: qs.ques, tally:0, skipped:0, hinted:0, confettiSwitch:false} \r\n})\r\n//After chosen a letter and before going saying it, remember it for referece of next game round\r\nconst rememberLetter: Action<SDSContext, SDSEvent> = assign((context) => { \r\n    return { lastLetter: context.letter} \r\n})\r\n// const remember3Letters: Action<SDSContext, SDSEvent> = assign((context) => { \r\n//     let last3Letters= context.lastLetters? context.lastLetters : []\r\n//     last3Letters.push(context.letter)\r\n//     if(last3Letters.length>3){\r\n//         last3Letters.shift()\r\n//     }\r\n//     return { lastLetters: last3Letters} \r\n// })\r\n\r\n\r\n//Say the current random letter and a 'spelling/phonetic' alphabet\r\nfunction letterNow(context:SDSContext){\r\n    let alphabet:any = {\r\n        'a':'Amanda', 'b':'Benedikt', 'c':'Cecilia', 'd':'Daniel', 'e':'Emma', 'f':'Filippa', 'g':'Gustav', 'h':'Håkan',\r\n        'i':'Ida', 'j':'Julia', 'k':'Klara', 'l':'Lotta', 'm':'Markus', 'n':'Natalie', 'o':'Olof', 'p':'Paula',\r\n        'q':'Queen', 'r':'Rebecka', 's':'Sven', 't':'Therese', 'u':'Ulla', 'v':'Viktoria', 'w':'Wanda', 'x':'Xavier',\r\n        'y':'Ylva', 'z':'Zara', 'å':'Åsa','ä':'Ängel', 'ö':'Örebro', \r\n        }\r\n    let letter:string = context.letter\r\n    return `Bokstaven är \"${letter.toUpperCase()}\" för \"${alphabet[letter]}\". `\r\n}\r\n\r\nfunction questionNow(context:SDSContext){\r\n    let category = context.questions[0].category //the question at front of array\r\n    return `Nämn ${category}. `\r\n}\r\n\r\nfunction giveHint(context:SDSContext){\r\n    let answers = context.questions[0].answers //answers to the question at front of array\r\n    let anAns = randomChoice(answers)\r\n    if (anAns.length >= 2) {\r\n        let hint = anAns.slice(0, 3).toUpperCase() //first 3 letters\r\n        return `Stavas med ${hint[0]}, ${hint[1]}, ${hint[2]}.`\r\n    }\r\n    //in case word is too short>>hint only 2 letters\r\n    else {\r\n        let hint = anAns.slice(0, 2).toUpperCase() //first 2 letters\r\n        return `Stavas med ${hint[0]}, ${hint[1]}.`\r\n    }\r\n}\r\n\r\n//Partial match of user input, as long as input mentions an answer\r\nfunction answerMatches(input:string,context:SDSContext){\r\n    let reply = input.toLowerCase() //convert to lowercase\r\n    let replySing = nounInflector.singularize( reply ) //convert to singular form\r\n\r\n    let answers = context.questions[0].answers //answers to the question at front of array\r\n\r\n    //True if reply--either original or singularised--mentions an answer \r\n    //(eg, 'the Netherlands' matches 'netherlands'; 'these strawberries' matches 'strawberry')\r\n    return  (exists(reply, answers) || exists(replySing, answers)) \r\n}\r\n\r\n\r\nfunction say(text: string): Action<SDSContext, SDSEvent> {\r\n    return send((_context: SDSContext) => ({ type: \"SPEAK\", value: text }))\r\n}\r\n\r\nfunction sharedRecognitions() {\r\n    return [\r\n        { target: 'stop', cond: (context:SDSContext) => sayKeyword(context.recResult) === 'stop' },\r\n        { target: 'restart', cond: (context:SDSContext) => sayKeyword(context.recResult) === 'restart' },\r\n        //for testing \r\n        { target: 'winning', cond: (context:SDSContext) => sayKeyword(context.recResult) === 'shortcut' },\r\n        { target: \".nomatch\" }\r\n        ]\r\n}\r\n\r\nfunction promptAndAsk(promptEvent: Action<SDSContext, SDSEvent>): MachineConfig<SDSContext, any, SDSEvent> {\r\n    return ({\r\n        initial: 'prompt',\r\n        states: {\r\n            prompt: {\r\n                entry: promptEvent,\r\n                on: { ENDSPEECH: 'ask' }\r\n            },\r\n            ask: {\r\n                entry: send('LISTEN'),\r\n            },\r\n            nomatch: { entry: [say(\"Försök igen\")],  \r\n                       on: { ENDSPEECH: \"prompt\" } \r\n            },\r\n        }\r\n    })\r\n}\r\n\r\n\r\n// Similar to python: any(keyword in input for keyword in keywords)\r\nfunction exists(input:string, keywords:string[]){\r\n    let existence = keywords.some(keyword => input.includes(keyword))\r\n    return existence\r\n}\r\n//Replace this with grammar parser?\r\nfunction sayKeyword(reply: string){\r\n    let yes=[\"ja\", \"naturligtvis\", \"säker\", \"absolut\", \"javisst\", \"visst\", \"okej\", \"ok\"]\r\n    let no=[\"nej\", \"nä\", \"nej tack\"]\r\n    let pass=[\"hoppa\", \"pass\", \"nästa\",]\r\n    let hint=[\"hint\", \"tips\", \"ledtråd\", \"hjälp\"]\r\n    let whatletter=['bokstav', 'upprepa']\r\n    let stop=['stop', 'avsluta', 'sluta', 'stopp']\r\n    let restart=['starta om', 'börja om', 'starta igen',\"omstarta\",\"börja igen\"]\r\n    let shortcut=['short cut', 'shortcut'] //for testing\r\n\r\n    reply=reply.toLowerCase()\r\n    if(exists(reply, yes)){ return 'yes' }\r\n    if(exists(reply, no)){ return 'no' }\r\n    if(exists(reply, pass)){ return 'pass' }\r\n    if(exists(reply, hint)){ return 'hint' }\r\n    if(exists(reply, whatletter)){ return 'whatletter' }\r\n    if(exists(reply, stop)){ return 'stop' }\r\n    if(exists(reply, restart)){ return 'restart' }\r\n    if(exists(reply, shortcut)){ return 'shortcut' } //for testing\r\n}\r\n\r\n\r\nexport const dmMachine: MachineConfig<SDSContext, any, SDSEvent> = ({\r\n    initial: 'init',\r\n    states: {\r\n        init: {\r\n            on: {\r\n                CLICK: 'start'\r\n            }\r\n        },\r\n        stop: {\r\n            entry: say(\"Hej och farväl!\"),\r\n            on: { ENDSPEECH: {\r\n                actions: [resetTally,clearLetter,clearTTSAgenda,clearRecResult,confettiOff, gameOff],\r\n                target:\"init\",\r\n                } \r\n            }\r\n        },\r\n        //Start/restart new game: initiate new questions-object & reset tally counter\r\n        start: {\r\n            entry: say(\"Var redo att spela!\"),\r\n            on: { ENDSPEECH: { target:\"chooseNewLetter\" } } \r\n        },\r\n        restart: {\r\n            entry: say(\"Okej, vi börjar om!\"),\r\n            on: { ENDSPEECH: {target:\"chooseNewLetter\" } } \r\n        },\r\n        chooseNewLetter :{\r\n            always:[\r\n                {actions: [newGameRound, clearTTSAgenda, clearRecResult],\r\n                 target: \"checkLastLetter\" }\r\n            ]\r\n        },\r\n\r\n        //After choosing letter, comparing to last letter game so that the new letter is not repeated\r\n        checkLastLetter: {\r\n            always: [\r\n                //if chosen letter is the same as last ones >> choose again\r\n                { cond: (context) => !!context.lastLetter && context.letter===context.lastLetter, \r\n                    target: 'chooseNewLetter', },\r\n\r\n                //chosen letter is different from last 3 letters >> remember it & resume game\r\n                { \r\n                  actions: [rememberLetter, gameOn, ],\r\n                  target: 'sayletter',  },\r\n            ]\r\n        },\r\n\r\n        //Starting the game for real from this state\r\n        //Say the letter\r\n        sayletter:{\r\n            entry: send((context)=>({ type: \"SPEAK\", value: letterNow(context) })),\r\n            on: {ENDSPEECH:'askQues' }\r\n        },\r\n\r\n        //Ask 5 (or more if skipping) questions \r\n        askQues: {\r\n            on: {\r\n                RECOGNISED: [\r\n                    \r\n                    // ? Clear recResult after recognition or not...?\r\n                    // If answer matches answers, tally+=1, shift question[0]\r\n                    {cond: (context:SDSContext) => answerMatches(context.recResult, context),\r\n                     actions: assign((context:SDSContext) => { \r\n                        context.questions.shift()\r\n                        return { tally: context.tally+1 } }),\r\n                     target:\"checkscore\"  },\r\n                    \r\n                    //If pass, move the question to the last (unshift & push)\r\n                    {cond: (context:SDSContext) => sayKeyword(context.recResult)==='pass', target:\"skip\"  },\r\n\r\n                    //Hint 3 or 2 letters\r\n                    {cond: (context:SDSContext) => sayKeyword(context.recResult)==='hint', target:\"hint\"},\r\n\r\n                    //Repeat letter\r\n                    {cond: (context:SDSContext) => sayKeyword(context.recResult)==='whatletter', target:\"sayletter\"},\r\n\r\n                    //Else    \r\n                    ...sharedRecognitions(),\r\n                    \r\n                ]},\r\n                ...promptAndAsk( send((context)=>({ type: \"SPEAK\", \r\n                                                    value: questionNow(context) })) )\r\n        },\r\n\r\n        skip: {\r\n            initial: 'checkSkipped',\r\n            states:{\r\n                checkSkipped:{\r\n                    always:[\r\n                        { target: 'letSkip', cond: (context) => context.skipped<5 },\r\n                        { target: 'maxSkipped', cond: (context) => context.skipped>=5 },\r\n                    ]\r\n                },\r\n                //move the question to the last (unshift & push); context.skipped++\r\n                letSkip:{\r\n                    entry:  assign((context:SDSContext) => { \r\n                        let skipped=context.questions.shift();\r\n                        context.questions.push(skipped);\r\n                        console.log(`Skipped so far: ${context.skipped+1} `)\r\n                        console.log(context.questions)\r\n                        return { skipped:context.skipped+1} }),\r\n                    always: '#checkscore'\r\n                },\r\n                maxSkipped:{\r\n                    entry: say(`Åjojoj, du har hoppat över för många gånger!`),\r\n                    on:{ ENDSPEECH: {target:'#checkscore'}}\r\n                }\r\n            }\r\n        },\r\n\r\n        hint: {\r\n            initial: 'checkHinted',\r\n            states:{\r\n                checkHinted:{\r\n                    always:[\r\n                        { target: 'giveHint', cond: (context) => context.hinted<5 },\r\n                        { target: 'maxHinted', cond: (context) => context.hinted>=5 },\r\n                    ]\r\n                },\r\n                //Hint 3 or 2 letters or a random answer; context.hinted++\r\n                giveHint:{\r\n                    entry: [\r\n                        send((context)=>({ type: \"SPEAK\", value: giveHint(context) })),\r\n                        assign((context:SDSContext) => {\r\n                            console.log(`Hinted so far: ${context.hinted+1} `);\r\n                            return { hinted:context.hinted+1} })\r\n                    ],\r\n                    always: '#checkscore' // use 'on endspeech...' if we want the question being said again\r\n                },\r\n                maxHinted:{\r\n                    entry: say(`Åjojoj, du har bett om för många hints!`),\r\n                    on:{ ENDSPEECH: {target:'#checkscore'}}\r\n                }\r\n            }\r\n        },\r\n        \r\n        checkscore:{\r\n            id:\"checkscore\",\r\n            always: [\r\n                //Less than 5 correct\r\n                { target: 'askQues', cond: (context) => context.tally<5 },\r\n\r\n                //5 correct\r\n                { target: 'winning', cond: (context) => context.tally>=5 },\r\n            ]\r\n        },\r\n\r\n                    //? reset/clear tally here or not...? \r\n        winning: {\r\n            entry: [ say(\"Du vann, winner winner chicken dinner!\"), confettiOn, clearTTSAgenda ], \r\n            on: {ENDSPEECH:{target:'playagain'}}\r\n        },\r\n        playagain: {\r\n            entry: [ clearRecResult, confettiOff, resetTally, clearLetter, gameOff,],\r\n            on: {\r\n                RECOGNISED: [\r\n                     //Play again? restart:stop\r\n                     {cond: (context:SDSContext) => sayKeyword(context.recResult)==='yes', target:\"restart\"},\r\n                     {cond: (context:SDSContext) => sayKeyword(context.recResult)==='no', target:\"stop\"},\r\n\r\n                    //Else    \r\n                    ...sharedRecognitions() \r\n                ]},\r\n                ...promptAndAsk( say('Vill du spela igen?') )\r\n        }, \r\n        \r\n    },\r\n\r\n})"]},"metadata":{},"sourceType":"module"}