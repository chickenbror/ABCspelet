{"ast":null,"code":"/*\n    Distribution class for probability distributions\n    Copyright (C) 2017 Hugo W.L. ter Doest\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n'use strict';\n\nvar Element = require('./Element');\n\nfunction Distribution(alpha, featureSet, sample) {\n  this.alpha = alpha;\n  this.featureSet = featureSet;\n  this.sample = sample;\n} // Returns the distribution as a string that can be stored for later usage\n\n\nDistribution.prototype.toString = function () {};\n\nDistribution.prototype.weight = function (x) {\n  var product = 1;\n  var that = this;\n  this.alpha.forEach(function (alphaj, j) {\n    product *= Math.pow(alphaj, that.featureSet.getFeatures()[j].apply(x));\n  });\n  return product;\n};\n\nDistribution.prototype.calculateAPriori = function (x) {\n  if (!this.aPriorisBeforeNormalisation[x.toString()]) {\n    this.aPriorisBeforeNormalisation[x.toString()] = this.weight(x);\n  }\n\n  return this.aPriorisBeforeNormalisation[x.toString()]; // / this.aPrioriNormalisationConstant;\n}; // Memoize a priori probabilities of sample elements\n\n\nDistribution.prototype.prepareWeights = function () {\n  this.aPriorisBeforeNormalisation = {};\n  this.aPrioriNormalisationConstant = 0;\n  var sum = 0;\n  var that = this;\n  this.sample.elements.forEach(function (x) {\n    that.aPriorisBeforeNormalisation[x.toString()] = that.weight(x);\n    sum += that.aPriorisBeforeNormalisation[x.toString()];\n  });\n  this.aPrioriNormalisationConstant = sum;\n};\n\nDistribution.prototype.calculateAPosteriori = function (x) {\n  if (!this.aPriorisBeforeNormalisation[x.toString()]) {\n    this.aPriorisBeforeNormalisation[x.toString()] = this.weight(x);\n  }\n\n  if (!this.aPosterioriNormalisationConstants[x.b.toString()]) {\n    this.aPosterioriNormalisationConstants[x.b.toString()] = this.aPosterioriNormalisation(x.b);\n  }\n\n  return this.aPriorisBeforeNormalisation[x] / this.aPosterioriNormalisationConstants[x.b.toString()];\n};\n\nDistribution.prototype.aPosterioriNormalisation = function (b) {\n  var sum = 0;\n  var that = this;\n  this.sample.getClasses().forEach(function (a) {\n    sum += that.weight(new Element(a, b));\n  });\n  return sum;\n}; // Memoize a posteriori probabilities of sample elements\n\n\nDistribution.prototype.prepareAPosterioris = function () {\n  this.aPosterioriNormalisationConstants = {};\n  var contextSeen = {};\n  var that = this;\n  this.sample.elements.forEach(function (sampleElement) {\n    var context = sampleElement.b;\n\n    if (!contextSeen[context]) {\n      contextSeen[context] = true;\n      that.aPosterioriNormalisationConstants[context] = that.aPosterioriNormalisation(context);\n    }\n  });\n}; // Memoize all probabilities of sample elements\n\n\nDistribution.prototype.prepare = function () {\n  this.prepareWeights(); // console.log(\"Weights prepared\");\n\n  this.prepareAPosterioris();\n}; // Relative entropy between observered distribution and derived distribution\n\n\nDistribution.prototype.KullbackLieblerDistance = function () {\n  var sum = 0;\n  var that = this;\n  this.sample.elements.forEach(function (x) {\n    sum += that.sample.observedProbability(x) * Math.log(that.sample.observedProbability(x) / that.calculateAPriori(x));\n  });\n  return sum;\n};\n\nDistribution.prototype.logLikelihood = function () {\n  var sum = 0;\n  var that = this;\n  this.sample.elements.forEach(function (x) {\n    sum += that.sample.observedProbability(x) * Math.log(that.calculateAPriori(x));\n  });\n  return sum;\n};\n\nDistribution.prototype.entropy = function () {\n  var sum = 0;\n  var that = this;\n  this.sample.elements.forEach(function (x) {\n    var p = that.calculateAPriori(x);\n    sum += p * Math.log(p);\n  });\n  return sum;\n};\n\nDistribution.prototype.checkSum = function () {\n  var sum = 0;\n  var that = this;\n  this.sample.elements.forEach(function (x) {\n    sum += that.calculateAPriori(x);\n  }); // console.log(\"Distribution.checkSum is \" + sum);\n\n  return sum;\n};\n\nmodule.exports = Distribution;","map":{"version":3,"sources":["C:/CodingProjects/ABCspelet/node_modules/natural/lib/natural/classifiers/maxent/Distribution.js"],"names":["Element","require","Distribution","alpha","featureSet","sample","prototype","toString","weight","x","product","that","forEach","alphaj","j","Math","pow","getFeatures","apply","calculateAPriori","aPriorisBeforeNormalisation","prepareWeights","aPrioriNormalisationConstant","sum","elements","calculateAPosteriori","aPosterioriNormalisationConstants","b","aPosterioriNormalisation","getClasses","a","prepareAPosterioris","contextSeen","sampleElement","context","prepare","KullbackLieblerDistance","observedProbability","log","logLikelihood","entropy","p","checkSum","module","exports"],"mappings":"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","sourcesContent":["/*\n    Distribution class for probability distributions\n    Copyright (C) 2017 Hugo W.L. ter Doest\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n'use strict'\n\nconst Element = require('./Element')\n\nfunction Distribution (alpha, featureSet, sample) {\n  this.alpha = alpha\n  this.featureSet = featureSet\n  this.sample = sample\n}\n\n// Returns the distribution as a string that can be stored for later usage\nDistribution.prototype.toString = function () {\n\n}\n\nDistribution.prototype.weight = function (x) {\n  let product = 1\n  const that = this\n\n  this.alpha.forEach(function (alphaj, j) {\n    product *= Math.pow(alphaj, that.featureSet.getFeatures()[j].apply(x))\n  })\n  return product\n}\n\nDistribution.prototype.calculateAPriori = function (x) {\n  if (!this.aPriorisBeforeNormalisation[x.toString()]) {\n    this.aPriorisBeforeNormalisation[x.toString()] = this.weight(x)\n  }\n  return this.aPriorisBeforeNormalisation[x.toString()]// / this.aPrioriNormalisationConstant;\n}\n\n// Memoize a priori probabilities of sample elements\nDistribution.prototype.prepareWeights = function () {\n  this.aPriorisBeforeNormalisation = {}\n  this.aPrioriNormalisationConstant = 0\n  let sum = 0\n  const that = this\n  this.sample.elements.forEach(function (x) {\n    that.aPriorisBeforeNormalisation[x.toString()] = that.weight(x)\n    sum += that.aPriorisBeforeNormalisation[x.toString()]\n  })\n  this.aPrioriNormalisationConstant = sum\n}\n\nDistribution.prototype.calculateAPosteriori = function (x) {\n  if (!this.aPriorisBeforeNormalisation[x.toString()]) {\n    this.aPriorisBeforeNormalisation[x.toString()] = this.weight(x)\n  }\n  if (!this.aPosterioriNormalisationConstants[x.b.toString()]) {\n    this.aPosterioriNormalisationConstants[x.b.toString()] = this.aPosterioriNormalisation(x.b)\n  }\n  return this.aPriorisBeforeNormalisation[x] / this.aPosterioriNormalisationConstants[x.b.toString()]\n}\n\nDistribution.prototype.aPosterioriNormalisation = function (b) {\n  let sum = 0\n\n  const that = this\n  this.sample.getClasses().forEach(function (a) {\n    sum += that.weight(new Element(a, b))\n  })\n\n  return (sum)\n}\n\n// Memoize a posteriori probabilities of sample elements\nDistribution.prototype.prepareAPosterioris = function () {\n  this.aPosterioriNormalisationConstants = {}\n\n  const contextSeen = {}\n  const that = this\n  this.sample.elements.forEach(function (sampleElement) {\n    const context = sampleElement.b\n    if (!contextSeen[context]) {\n      contextSeen[context] = true\n      that.aPosterioriNormalisationConstants[context] =\n        that.aPosterioriNormalisation(context)\n    }\n  })\n}\n\n// Memoize all probabilities of sample elements\nDistribution.prototype.prepare = function () {\n  this.prepareWeights()\n  // console.log(\"Weights prepared\");\n  this.prepareAPosterioris()\n}\n\n// Relative entropy between observered distribution and derived distribution\nDistribution.prototype.KullbackLieblerDistance = function () {\n  let sum = 0\n  const that = this\n  this.sample.elements.forEach(function (x) {\n    sum += that.sample.observedProbability(x) * Math.log(that.sample.observedProbability(x) / that.calculateAPriori(x))\n  })\n  return sum\n}\n\nDistribution.prototype.logLikelihood = function () {\n  let sum = 0\n  const that = this\n  this.sample.elements.forEach(function (x) {\n    sum += that.sample.observedProbability(x) * Math.log(that.calculateAPriori(x))\n  })\n  return sum\n}\n\nDistribution.prototype.entropy = function () {\n  let sum = 0\n  const that = this\n  this.sample.elements.forEach(function (x) {\n    const p = that.calculateAPriori(x)\n    sum += p * Math.log(p)\n  })\n  return sum\n}\n\nDistribution.prototype.checkSum = function () {\n  let sum = 0\n  const that = this\n  this.sample.elements.forEach(function (x) {\n    sum += that.calculateAPriori(x)\n  })\n  // console.log(\"Distribution.checkSum is \" + sum);\n  return sum\n}\n\nmodule.exports = Distribution\n"]},"metadata":{},"sourceType":"script"}