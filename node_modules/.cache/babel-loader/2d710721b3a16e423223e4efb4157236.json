{"ast":null,"code":"import _toConsumableArray from\"C:/CodingProjects/ABCgame/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:/CodingProjects/ABCgame/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{assign,send}from\"xstate\";//Instantiate a new obj for each new round of game\nimport{makeNewQuestions,randomChoice}from'./game_codes/game';// let qs=makeNewQuestions()\n// console.log(qs.letter)\n// console.log(qs.ques)\n//Using \"Natural\" NLP library\nvar natural=require('natural'),nounInflector=new natural.NounInflector();// let singular = nounInflector.singularize('those tomatoes');\n// console.log(singular); //>>those tomato\nvar clearRecResult=assign(function(context){return{recResult:''};});var clearTTSAgenda=assign(function(context){return{ttsAgenda:''};});var resetTally=assign(function(context){return{tally:0};});var clearLetter=assign(function(context){return{letter:undefined};});var confettiOn=assign(function(context){return{confettiSwitch:true};});var confettiOff=assign(function(context){return{confettiSwitch:false};});var gameOn=assign(function(context){return{playingNow:true};});var gameOff=assign(function(context){return{playingNow:false};});//Initiate a questions object & assign values to context.letter/questions/tally\nvar newGameRound=assign(function(context){var qs=makeNewQuestions();console.log(\"Last round:\".concat(context.lastLetter));console.log(qs.ques);return{letter:qs.letter,questions:qs.ques,tally:0,confettiSwitch:false};});//After chosen a letter and before going saying it, remember it for referece of next game round\nvar rememberLetter=assign(function(context){return{lastLetter:context.letter};});// const remember3Letters: Action<SDSContext, SDSEvent> = assign((context) => { \n//     let last3Letters= context.lastLetters? context.lastLetters : []\n//     last3Letters.push(context.letter)\n//     if(last3Letters.length>3){\n//         last3Letters.shift()\n//     }\n//     return { lastLetters: last3Letters} \n// })\n//Say the current random letter and a 'spelling/phonetic' alphabet\nfunction letterNow(context){var alphabet={'a':'Adam','b':'Bella','c':'Cindy','d':'Daniel','e':'Eva','f':'Francesca','g':'Gabriel','h':'Harry','i':'Ida','j':'Julia','k':'Kevin','l':'Laura','m':'Michael','n':'Nicole','o':'Oscar','p':'Paula','q':'Quebec','r':'Rachel','s':'Sara','t':'Tina','u':'unique','v':'Victoria','w':'window','x':'x-ray','y':'yesman','z':'zero'};var letter=context.letter;return\"Your letter is \\\"\".concat(letter.toUpperCase(),\"\\\" for \\\"\").concat(alphabet[letter],\"\\\". \");}function questionNow(context){var category=context.questions[0].category;//the question at front of array\nreturn\"Name \".concat(category,\". \");}function giveHint(context){var answers=context.questions[0].answers;//answers to the question at front of array\nvar anAns=randomChoice(answers);if(anAns.length>=3){var hint=anAns.slice(0,3).toUpperCase();//first 3 letters\nreturn\"Spelled with \".concat(hint[0],\", \").concat(hint[1],\", \").concat(hint[2],\".\");}//in case word is too short>>hint only 2 letters\nelse{var _hint=anAns.slice(0,2).toUpperCase();//first 2 letters\nreturn\"Spelled with \".concat(_hint[0],\", \").concat(_hint[1],\", \").concat(_hint[2],\".\");}}//Partial match of user input, as long as input mentions an answer\nfunction answerMatches(input,context){var reply=input.toLowerCase();//convert to lowercase\nvar replySing=nounInflector.singularize(reply);//convert to singular form\nvar answers=context.questions[0].answers;//answers to the question at front of array\n//True if reply--either original or singularised--mentions an answer \n//(eg, 'the Netherlands' matches 'netherlands'; 'these strawberries' matches 'strawberry')\nreturn exists(reply,answers)||exists(replySing,answers);}function say(text){return send(function(_context){return{type:\"SPEAK\",value:text};});}function sharedRecognitions(){return[{target:'stop',cond:function cond(context){return sayKeyword(context.recResult)==='stop';}},{target:'restart',cond:function cond(context){return sayKeyword(context.recResult)==='restart';}},//for testing \n{target:'winning',cond:function cond(context){return sayKeyword(context.recResult)==='shortcut';}},{target:\".nomatch\"}];}function promptAndAsk(promptEvent){return{initial:'prompt',states:{prompt:{entry:promptEvent,on:{ENDSPEECH:'ask'}},ask:{entry:send('LISTEN')},nomatch:{entry:[say(\"Try again\")],on:{ENDSPEECH:\"prompt\"}}}};}// Similar to python: any(keyword in input for keyword in keywords)\nfunction exists(input,keywords){var existence=keywords.some(function(keyword){return input.includes(keyword);});return existence;}//Replace this with grammar parser?\nfunction sayKeyword(reply){var yes=[\"yes\",\"of course\",\"sure\",\"absolutely\",\"yeah\",\"yep\",\"okay\",\"ok\"];var no=[\"no\",\"nope\",\"no thanks\",\"nah\"];var pass=[\"skip\",\"pass\",\"next\"];var hint=[\"hint\",\"clue\",\"help\"];var whatletter=['letter','repeat'];var stop=['stop','end the game','shut down'];var restart=['restart','start again','reboot'];var shortcut=['short cut','shortcut'];//for testing\nreply=reply.toLowerCase();if(exists(reply,yes)){return'yes';}if(exists(reply,no)){return'no';}if(exists(reply,pass)){return'pass';}if(exists(reply,hint)){return'hint';}if(exists(reply,whatletter)){return'whatletter';}if(exists(reply,stop)){return'stop';}if(exists(reply,restart)){return'restart';}if(exists(reply,shortcut)){return'shortcut';}//for testing\n}/*\r\nNOTES\r\nSwear words are censored so won't match. Unless change them to f*** in the JSON\r\n? Find out how to show prompts & recognised text on screen\r\n? Confetti effect in winning state\r\n! Need to lemmatize userinput. Use js-lemmatizer, Natural, and/or Wink libraries \r\n*/export var dmMachine={initial:'init',states:{init:{on:{CLICK:'start'}},stop:{entry:say(\"Ok bye!\"),on:{ENDSPEECH:{actions:[resetTally,clearLetter,clearTTSAgenda,clearRecResult,confettiOff,gameOff],target:\"init\"}}},//Start/restart new game: initiate new questions-object & reset tally counter\nstart:{entry:say(\"Starting the game \"),on:{ENDSPEECH:{target:\"chooseNewLetter\"}}},restart:{entry:say(\"Ok, starting over\"),on:{ENDSPEECH:{target:\"chooseNewLetter\"}}},chooseNewLetter:{always:[{actions:[newGameRound,clearTTSAgenda,clearRecResult],target:\"checkLastLetter\"}]},//After choosing letter, comparing to last letter game so that the new letter is not repeated\ncheckLastLetter:{always:[//if chosen letter is the same as last ones >> choose again\n{cond:function cond(context){return!!context.lastLetter&&context.letter===context.lastLetter;},target:'chooseNewLetter'},//chosen letter is different from last 3 letters >> remember it & resume game\n{actions:[rememberLetter,gameOn],target:'sayletter'}]},//Starting the game for real from this state\n//Say the letter\nsayletter:{entry:send(function(context){return{type:\"SPEAK\",value:letterNow(context)};}),on:{ENDSPEECH:'askQues'}},//Ask 5 (or more if skipping) questions \naskQues:_objectSpread({on:{RECOGNISED:[// ? Clear recResult after recognition or not...?\n// If answer matches answers, tally+=1, shift question[0]\n{cond:function cond(context){return answerMatches(context.recResult,context);},actions:assign(function(context){context.questions.shift();return{tally:context.tally+1};}),target:\"checkscore\"},//If pass, move the question to the last (unshift & push)\n{cond:function cond(context){return sayKeyword(context.recResult)==='pass';},actions:assign(function(context){var skipped=context.questions.shift();context.questions.push(skipped);console.log(context.questions);return{};}),target:\"checkscore\"},//Hint 3 or 2 letters\n{cond:function cond(context){return sayKeyword(context.recResult)==='hint';},target:\"hint\"},//Repeat letter\n{cond:function cond(context){return sayKeyword(context.recResult)==='whatletter';},target:\"sayletter\"}].concat(_toConsumableArray(sharedRecognitions()))}},promptAndAsk(send(function(context){return{type:\"SPEAK\",value:questionNow(context)};}))),hint:{entry:send(function(context){return{type:\"SPEAK\",value:giveHint(context)};}),always:'checkscore'},checkscore:{always:[//Less than 5 correct\n{target:'askQues',cond:function cond(context){return context.tally<5;}},//5 correct\n{target:'winning',cond:function cond(context){return context.tally>=5;}}]},//? reset/clear tally here or not...? \nwinning:{entry:[say(\"Winner winner chicken dinner\"),confettiOn,clearTTSAgenda],on:{ENDSPEECH:{target:'playagain'}}},playagain:_objectSpread({entry:[clearRecResult,confettiOff,resetTally,clearLetter,gameOff],on:{RECOGNISED:[//Play again? restart:stop\n{cond:function cond(context){return sayKeyword(context.recResult)==='yes';},target:\"restart\"},{cond:function cond(context){return sayKeyword(context.recResult)==='no';},target:\"stop\"}].concat(_toConsumableArray(sharedRecognitions()))}},promptAndAsk(say('Want to play again?')))}};","map":{"version":3,"sources":["C:/CodingProjects/ABCgame/src/dmGame.ts"],"names":["assign","send","makeNewQuestions","randomChoice","natural","require","nounInflector","NounInflector","clearRecResult","context","recResult","clearTTSAgenda","ttsAgenda","resetTally","tally","clearLetter","letter","undefined","confettiOn","confettiSwitch","confettiOff","gameOn","playingNow","gameOff","newGameRound","qs","console","log","lastLetter","ques","questions","rememberLetter","letterNow","alphabet","toUpperCase","questionNow","category","giveHint","answers","anAns","length","hint","slice","answerMatches","input","reply","toLowerCase","replySing","singularize","exists","say","text","_context","type","value","sharedRecognitions","target","cond","sayKeyword","promptAndAsk","promptEvent","initial","states","prompt","entry","on","ENDSPEECH","ask","nomatch","keywords","existence","some","keyword","includes","yes","no","pass","whatletter","stop","restart","shortcut","dmMachine","init","CLICK","actions","start","chooseNewLetter","always","checkLastLetter","sayletter","askQues","RECOGNISED","shift","skipped","push","checkscore","winning","playagain"],"mappings":"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","sourcesContent":["import { MachineConfig, actions, Action, assign, send } from \"xstate\";\r\n\r\n//Instantiate a new obj for each new round of game\r\nimport { makeNewQuestions, randomChoice } from './game_codes/game'\r\n// let qs=makeNewQuestions()\r\n// console.log(qs.letter)\r\n// console.log(qs.ques)\r\n\r\n//Using \"Natural\" NLP library\r\nconst natural = require('natural'),\r\nnounInflector = new natural.NounInflector();\r\n// let singular = nounInflector.singularize('those tomatoes');\r\n// console.log(singular); //>>those tomato\r\n\r\n\r\nconst clearRecResult: Action<SDSContext, SDSEvent> = assign((context) => { return { recResult:''} })\r\nconst clearTTSAgenda: Action<SDSContext, SDSEvent> = assign((context) => { return { ttsAgenda:''} })\r\nconst resetTally: Action<SDSContext, SDSEvent> = assign((context) => { return { tally:0} })\r\nconst clearLetter: Action<SDSContext, SDSEvent> = assign((context) => { return { letter:undefined} })\r\n\r\nconst confettiOn: Action<SDSContext, SDSEvent> = assign((context) => { return { confettiSwitch:true} })\r\nconst confettiOff: Action<SDSContext, SDSEvent> = assign((context) => { return { confettiSwitch:false} })\r\n\r\nconst gameOn: Action<SDSContext, SDSEvent> = assign((context) => { return { playingNow:true} })\r\nconst gameOff: Action<SDSContext, SDSEvent> = assign((context) => { return { playingNow:false} })\r\n\r\n//Initiate a questions object & assign values to context.letter/questions/tally\r\nconst newGameRound: Action<SDSContext, SDSEvent> = assign((context) => { \r\n    let qs=makeNewQuestions();\r\n    console.log(`Last round:${context.lastLetter}`)\r\n    console.log(qs.ques)\r\n    return { letter: qs.letter, questions: qs.ques, tally:0, confettiSwitch:false} \r\n})\r\n//After chosen a letter and before going saying it, remember it for referece of next game round\r\nconst rememberLetter: Action<SDSContext, SDSEvent> = assign((context) => { \r\n    return { lastLetter: context.letter} \r\n})\r\n// const remember3Letters: Action<SDSContext, SDSEvent> = assign((context) => { \r\n//     let last3Letters= context.lastLetters? context.lastLetters : []\r\n//     last3Letters.push(context.letter)\r\n//     if(last3Letters.length>3){\r\n//         last3Letters.shift()\r\n//     }\r\n//     return { lastLetters: last3Letters} \r\n// })\r\n\r\n\r\n//Say the current random letter and a 'spelling/phonetic' alphabet\r\nfunction letterNow(context:SDSContext){\r\n    let alphabet:any = {\r\n        'a':'Adam', 'b':'Bella', 'c':'Cindy', 'd':'Daniel', 'e':'Eva', 'f':'Francesca', 'g':'Gabriel', 'h':'Harry',\r\n        'i':'Ida', 'j':'Julia', 'k':'Kevin', 'l':'Laura', 'm':'Michael', 'n':'Nicole', 'o':'Oscar', 'p':'Paula',\r\n        'q':'Quebec', 'r':'Rachel', 's':'Sara', 't':'Tina', 'u':'unique', 'v':'Victoria', 'w':'window', 'x':'x-ray',\r\n        'y':'yesman', 'z':'zero'\r\n        }\r\n    let letter:string = context.letter\r\n    return `Your letter is \"${letter.toUpperCase()}\" for \"${alphabet[letter]}\". `\r\n}\r\n\r\nfunction questionNow(context:SDSContext){\r\n    let category = context.questions[0].category //the question at front of array\r\n    return `Name ${category}. `\r\n}\r\n\r\nfunction giveHint(context:SDSContext){\r\n    let answers = context.questions[0].answers //answers to the question at front of array\r\n    let anAns = randomChoice(answers)\r\n    if (anAns.length >= 3) {\r\n        let hint = anAns.slice(0, 3).toUpperCase() //first 3 letters\r\n        return `Spelled with ${hint[0]}, ${hint[1]}, ${hint[2]}.`\r\n    }\r\n    //in case word is too short>>hint only 2 letters\r\n    else {\r\n        let hint = anAns.slice(0, 2).toUpperCase() //first 2 letters\r\n        return `Spelled with ${hint[0]}, ${hint[1]}, ${hint[2]}.`\r\n    }\r\n}\r\n\r\n//Partial match of user input, as long as input mentions an answer\r\nfunction answerMatches(input:string,context:SDSContext){\r\n    let reply = input.toLowerCase() //convert to lowercase\r\n    let replySing = nounInflector.singularize( reply ) //convert to singular form\r\n\r\n    let answers = context.questions[0].answers //answers to the question at front of array\r\n\r\n    //True if reply--either original or singularised--mentions an answer \r\n    //(eg, 'the Netherlands' matches 'netherlands'; 'these strawberries' matches 'strawberry')\r\n    return  (exists(reply, answers) || exists(replySing, answers)) \r\n}\r\n\r\n\r\nfunction say(text: string): Action<SDSContext, SDSEvent> {\r\n    return send((_context: SDSContext) => ({ type: \"SPEAK\", value: text }))\r\n}\r\n\r\nfunction sharedRecognitions() {\r\n    return [\r\n        { target: 'stop', cond: (context:SDSContext) => sayKeyword(context.recResult) === 'stop' },\r\n        { target: 'restart', cond: (context:SDSContext) => sayKeyword(context.recResult) === 'restart' },\r\n        //for testing \r\n        { target: 'winning', cond: (context:SDSContext) => sayKeyword(context.recResult) === 'shortcut' },\r\n        { target: \".nomatch\" }\r\n        ]\r\n}\r\n\r\nfunction promptAndAsk(promptEvent: Action<SDSContext, SDSEvent>): MachineConfig<SDSContext, any, SDSEvent> {\r\n    return ({\r\n        initial: 'prompt',\r\n        states: {\r\n            prompt: {\r\n                entry: promptEvent,\r\n                on: { ENDSPEECH: 'ask' }\r\n            },\r\n            ask: {\r\n                entry: send('LISTEN'),\r\n            },\r\n            nomatch: { entry: [say(\"Try again\")],  \r\n                       on: { ENDSPEECH: \"prompt\" } \r\n            },\r\n        }\r\n    })\r\n}\r\n\r\n\r\n// Similar to python: any(keyword in input for keyword in keywords)\r\nfunction exists(input:string, keywords:string[]){\r\n    let existence = keywords.some(keyword => input.includes(keyword))\r\n    return existence\r\n}\r\n//Replace this with grammar parser?\r\nfunction sayKeyword(reply: string){\r\n    let yes=[\"yes\", \"of course\", \"sure\", \"absolutely\", \"yeah\", \"yep\", \"okay\", \"ok\"]\r\n    let no=[\"no\", \"nope\", \"no thanks\", \"nah\",]\r\n    let pass=[\"skip\", \"pass\", \"next\",]\r\n    let hint=[\"hint\", \"clue\", \"help\"]\r\n    let whatletter=['letter','repeat']\r\n    let stop=['stop','end the game','shut down']\r\n    let restart=['restart','start again', 'reboot']\r\n    let shortcut=['short cut', 'shortcut'] //for testing\r\n\r\n    reply=reply.toLowerCase()\r\n    if(exists(reply, yes)){ return 'yes' }\r\n    if(exists(reply, no)){ return 'no' }\r\n    if(exists(reply, pass)){ return 'pass' }\r\n    if(exists(reply, hint)){ return 'hint' }\r\n    if(exists(reply, whatletter)){ return 'whatletter' }\r\n    if(exists(reply, stop)){ return 'stop' }\r\n    if(exists(reply, restart)){ return 'restart' }\r\n    if(exists(reply, shortcut)){ return 'shortcut' } //for testing\r\n}\r\n\r\n/*\r\nNOTES\r\nSwear words are censored so won't match. Unless change them to f*** in the JSON\r\n? Find out how to show prompts & recognised text on screen\r\n? Confetti effect in winning state\r\n! Need to lemmatize userinput. Use js-lemmatizer, Natural, and/or Wink libraries \r\n*/\r\n\r\nexport const dmMachine: MachineConfig<SDSContext, any, SDSEvent> = ({\r\n    initial: 'init',\r\n    states: {\r\n        init: {\r\n            on: {\r\n                CLICK: 'start'\r\n            }\r\n        },\r\n        stop: {\r\n            entry: say(\"Ok bye!\"),\r\n            on: { ENDSPEECH: {\r\n                actions: [resetTally,clearLetter,clearTTSAgenda,clearRecResult,confettiOff, gameOff],\r\n                target:\"init\",\r\n                } \r\n            }\r\n        },\r\n        //Start/restart new game: initiate new questions-object & reset tally counter\r\n        start: {\r\n            entry: say(\"Starting the game \"),\r\n            on: { ENDSPEECH: { target:\"chooseNewLetter\" } } \r\n        },\r\n        restart: {\r\n            entry: say(\"Ok, starting over\"),\r\n            on: { ENDSPEECH: {target:\"chooseNewLetter\" } } \r\n        },\r\n        chooseNewLetter :{\r\n            always:[\r\n                {actions: [newGameRound, clearTTSAgenda, clearRecResult],\r\n                 target: \"checkLastLetter\" }\r\n            ]\r\n        },\r\n\r\n        //After choosing letter, comparing to last letter game so that the new letter is not repeated\r\n        checkLastLetter: {\r\n            always: [\r\n                //if chosen letter is the same as last ones >> choose again\r\n                { cond: (context) => !!context.lastLetter && context.letter===context.lastLetter, \r\n                    target: 'chooseNewLetter', },\r\n\r\n                //chosen letter is different from last 3 letters >> remember it & resume game\r\n                { \r\n                  actions: [rememberLetter, gameOn, ],\r\n                  target: 'sayletter',  },\r\n            ]\r\n        },\r\n\r\n        //Starting the game for real from this state\r\n        //Say the letter\r\n        sayletter:{\r\n            entry: send((context)=>({ type: \"SPEAK\", value: letterNow(context) })),\r\n            on: {ENDSPEECH:'askQues' }\r\n        },\r\n\r\n        //Ask 5 (or more if skipping) questions \r\n        askQues: {\r\n            on: {\r\n                RECOGNISED: [\r\n                    \r\n                    // ? Clear recResult after recognition or not...?\r\n                    // If answer matches answers, tally+=1, shift question[0]\r\n                    {cond: (context:SDSContext) => answerMatches(context.recResult, context),\r\n                     actions: assign((context:SDSContext) => { \r\n                        context.questions.shift()\r\n                        return { tally: context.tally+1 } }),\r\n                     target:\"checkscore\"  },\r\n                    \r\n                    //If pass, move the question to the last (unshift & push)\r\n                    {cond: (context:SDSContext) => sayKeyword(context.recResult)==='pass',\r\n                     actions: assign((context:SDSContext) => { \r\n                        let skipped=context.questions.shift();\r\n                        context.questions.push(skipped);\r\n                        console.log(context.questions)\r\n                        return { } }),\r\n                     target:\"checkscore\"  },\r\n\r\n                    //Hint 3 or 2 letters\r\n                    {cond: (context:SDSContext) => sayKeyword(context.recResult)==='hint', target:\"hint\"},\r\n                    //Repeat letter\r\n                    {cond: (context:SDSContext) => sayKeyword(context.recResult)==='whatletter', target:\"sayletter\"},\r\n\r\n                    //Else    \r\n                    ...sharedRecognitions(),\r\n                    \r\n                ]},\r\n                ...promptAndAsk( send((context)=>({ type: \"SPEAK\", \r\n                                                    value: questionNow(context) })) )\r\n        },\r\n\r\n        hint: {\r\n            entry: send((context)=>({ type: \"SPEAK\", value: giveHint(context) })),\r\n            always: 'checkscore'\r\n        },\r\n        \r\n        checkscore:{\r\n            always: [\r\n                //Less than 5 correct\r\n                { target: 'askQues', cond: (context) => context.tally<5 },\r\n\r\n                //5 correct\r\n                { target: 'winning', cond: (context) => context.tally>=5 },\r\n            ]\r\n        },\r\n\r\n                    //? reset/clear tally here or not...? \r\n        winning: {\r\n            entry: [ say(\"Winner winner chicken dinner\"), confettiOn, clearTTSAgenda ], \r\n            on: {ENDSPEECH:{target:'playagain'}}\r\n        },\r\n        playagain: {\r\n            entry: [ clearRecResult, confettiOff, resetTally, clearLetter, gameOff,],\r\n            on: {\r\n                RECOGNISED: [\r\n                     //Play again? restart:stop\r\n                     {cond: (context:SDSContext) => sayKeyword(context.recResult)==='yes', target:\"restart\"},\r\n                     {cond: (context:SDSContext) => sayKeyword(context.recResult)==='no', target:\"stop\"},\r\n\r\n                    //Else    \r\n                    ...sharedRecognitions() \r\n                ]},\r\n                ...promptAndAsk( say('Want to play again?') )\r\n        }, \r\n        \r\n    },\r\n\r\n})"]},"metadata":{},"sourceType":"module"}